@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@{
    var loginUrl = Configuration["ApiSettings:LoginUrl"];
}
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div>
    <div class="container mt-4">
        <h4>Edit Skill</h4>
        @* <input type="text" id="skillId" /> *@
        <input type="hidden" id="skillId" />

        <div class="mb-3">
            <label for="skillName" class="form-label">Skill Name*</label>
            <input type="text" id="skillName" class="form-control" required />
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description</label>
            <textarea id="description" class="form-control"></textarea>
        </div>
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="isActive" checked />
            <label class="form-check-label" for="isActive">Is Active</label>
        </div>

        <button class="btn btn-success btn-sm" onclick="updateSkill()">Update</button>
        <a href="/Skill" class="btn btn-sm btn-primary">Back To List</a>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
        const baseUrl = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(loginUrl));
        const segments = window.location.pathname.split("/");
        const skillIdStr = segments[segments.length - 1];
        const skillId = parseInt(skillIdStr); // 🔁 Convert to number

       

    $(document).ready(function () {
        // if (!skillId) {
        //     alert("Skill ID is missing.");
        //     return;
        // }

        $.ajax({
            url: `${baseUrl}api/Skill/GetById/${skillId}`,
            method: "GET",
            success: function (skill) {
                $("#skillId").val(skill.skillId);
                $("#skillName").val(skill.skillName);
                $("#description").val(skill.description);
                $("#isActive").prop("checked", skill.isActive);
            },
            error: function (xhr) {
                console.error(xhr);
                alert("Failed to load skill data.");
            }
        });
    });

      function updateSkill() {
      debugger;
      var skillNameCheck = $("#skillName").val();

      if (!skillNameCheck) {
        alert("Skill Name is required !");
        return;
      }


        const userCode = localStorage.getItem("userCode");

        const updatedSkill = {
            SkillId: parseInt($("#skillId").val()),
            SkillName: $("#skillName").val(),
            Description: $("#description").val(),
            DateAdded: new Date().toISOString(),
            AddedBy: userCode,
            IsActive: $("#isActive").is(":checked")
        };

        debugger;

        $.ajax({
            url: `${baseUrl}api/Skill/Update/${updatedSkill.SkillId}`, // id in URL
            method: "PUT",
            contentType: "application/json",
            data: JSON.stringify(updatedSkill),
            success: function () {
                alert("Skill updated successfully!");
                window.location.href = "/Skill";
            },
            error: function (xhr) {
                console.error(xhr);
                let errMsg = "Failed to update skill.";
                if (xhr.responseText) errMsg += "\n" + xhr.responseText;
                alert(errMsg);
            }
        });
    }
</script>



