@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@using Microsoft.Extensions.Configuration
@inject IConfiguration Configuration
@{
    var loginUrl = Configuration["ApiSettings:LoginUrl"];
}
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div>
    <div class="container mt-4">
        <h4>Edit SkillLevel</h4>
        @* <input type="text" id="SkillLevelId" /> *@
        <input type="hidden" id="SkillLevelId" />

        <div class="mb-3">
            <label for="SkillLevelName" class="form-label">SkillLevel Name</label>
            <input type="text" id="SkillLevelName" class="form-control" required />
        </div>
        <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="isActive" checked />
            <label class="form-check-label" for="isActive">Is Active</label>
        </div>

        <button class="btn btn-success" onclick="updateSkillLevel()">Update</button>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    const baseUrl = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(loginUrl));

        const segments = window.location.pathname.split("/");
        const SkillLevelIdStr = segments[segments.length - 1];
        const SkillLevelId = parseInt(SkillLevelIdStr); // 🔁 Convert to number

    $(document).ready(function () {
        // if (!SkillLevelId) {
        //     alert("SkillLevel ID is missing.");
        //     return;
        // }

        $.ajax({
            url: `${baseUrl}api/SkillLevel/GetById/${SkillLevelId}`,
            method: "GET",
            success: function (SkillLevel) {
                $("#SkillLevelId").val(SkillLevel.skillLevelId);
                $("#SkillLevelName").val(SkillLevel.name);
                $("#isActive").prop("checked", SkillLevel.isActive);
            },
            error: function (xhr) {
                console.error(xhr);
                alert("Failed to load SkillLevel data.");
            }
        });
    });

    function updateSkillLevel() {
            debugger;
        const userCode = localStorage.getItem("userCode");

        const updatedSkillLevel = {
            skillLevelId: parseInt($("#SkillLevelId").val()),
            name: $("#SkillLevelName").val(),
            dateAdded: new Date().toISOString(), // Optional: use original date
            addedBy: userCode,
            isActive: $("#isActive").is(":checked")
        };

        $.ajax({
            url: `${baseUrl}api/SkillLevel/Update`, // ✅ Replace with your actual API route
            method: "PUT", // Or POST if your API uses that
            contentType: "application/json",
            data: JSON.stringify(updatedSkillLevel),
            success: function () {
                alert("SkillLevel updated successfully!");
                window.location.href = "/SkillLevel"; // Redirect back to list
            },
            error: function (xhr) {
                console.error(xhr);
                alert("Failed to update SkillLevel.");
            }
        });
    }
</script>



